<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" />
    <script type="text/javascript" src="../scripts/libraries/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
    <br />
    <br />
    <br />
    <div class="container-fluid">
        <h4>Activities grouped by categories:</h4>
        <div id="categories">
            
        </div>
        <div class="col-md-3">
            <button onclick="addCategory()" type="button" class="btn btn-info btn-lg" style="padding: 20px 15px;">
                + Add
                <br />
                Category
            </button>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            appController.showDevTools();
            loadCategories();
        });

        function addActivity(categoryId) {
            appController.addActivity(categoryId);
            loadCategories();
        }

        function addCategory() {
            appController.addCategory();
            loadCategories();
        }

        function deleteCategory(id) {
            appController.deleteCategory(id);
            loadCategories();
        }

        function deleteActivity(id) {
            appController.deleteActivity(id);
            loadCategories();
        }

        function loadCategories() {
            $("#categories").html('');
            var categories = appController.getCategories();
            var categoriesJson = JSON.parse(categories);
            for (var i in categoriesJson) {
                var html = '<div class="col-md-4 category"><ul class="list-group">';
                html += '<li class="list-group-item list-group-item-info">' + categoriesJson[i].Name + '<button type="button" class="btn btn-sm btn-danger pull-right" style="padding: 4px" onclick="deleteCategory('+ categoriesJson[i].Id +')">x</button></li>';
                for (var j in categoriesJson[i].Activities) {
                    html += '<li class="list-group-item">' + categoriesJson[i].Activities[j].Name + '<a class="text-danger pull-right" onclick="deleteActivity(' + categoriesJson[i].Activities[j].Id + ')">x</a></li>';
                }  
                html += '<button type="button" class="list-group-item btn-info text-muted" onclick="addActivity(' + categoriesJson[i].Id + ')">+ Add new activity to category</button> </ul></div>';
                $("#categories").append(html);
            }
        }
    </script>
</body>
</html>